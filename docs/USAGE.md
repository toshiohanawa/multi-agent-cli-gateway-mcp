# 使用方法ガイド

このドキュメントでは、MCPツールの使用方法を説明します。

## 目次

1. [基本的な使用方法](#基本的な使用方法)
2. [複数プロジェクトでの使用](#複数プロジェクトでの使用)
3. [利用可能なツール](#利用可能なツール)
4. [使用例](#使用例)
5. [トラブルシューティング](#トラブルシューティング)

## 基本的な使用方法

### 議論を開始

Cursorのチャットで以下のように指示します：

```
CodexとClaudeCodeに議論させて。まずはこのテーマで始めて：
「PythonでFizzBuzzを実装してください。」
```

Cursor LLMが自動的に `start_debate` ツールを呼び出し、CodexとClaudeの両方から応答を取得します。

### 次のステップに進む

CodexとClaudeの応答を比較した後、意見が割れた場合、以下のように指示します：

#### Codexの方針を採用する場合
```
Codexの方針を採用して次に進めて
```

#### Claudeの方針を採用する場合
```
Claudeの方針を採用して次に進めて
```

#### 独自の方針を指定する場合
```
以下の方針で次に進めて：
「より効率的な実装を提案してください。」
```

Cursor LLMが自動的に `step` ツールを呼び出し、新しいターンを生成します。

### 議論を終了

```
ここで議論を終了して
```

または

```
議論を終了してください
```

Cursor LLMが自動的に `stop` ツールを呼び出します。

## 複数プロジェクトでの使用

### 概要

**はい、リポジトリを変えても、Dockerコンテナとホストラッパーが動いていれば使用できます！**

MCPサーバーは独立したサービスとして動作しているため、どのプロジェクトからでもCursor経由でアクセス可能です。

### 動作の仕組み

1. **MCPサーバーの独立性**
   - MCPブリッジ: Dockerコンテナで動作（`localhost:8080`）
   - ホストラッパー: 独立したプロセスとして動作（`localhost:9001`, `9002`）
   - CursorのMCP設定: グローバル設定（プロジェクトに依存しない）

2. **必要な条件**
   - Dockerコンテナが起動中
   - ホストラッパーが起動中
   - CursorのMCP設定が完了している

### 使用例

```bash
# プロジェクトAで使用
cd /path/to/project-a
# CursorでMCPツールを使用 → localhost:8080に接続

# プロジェクトBで使用
cd /path/to/project-b
# 同じMCPサーバー（localhost:8080）を使用可能
```

### セッション管理

- **同じユーザーID**: 複数のプロジェクトから同じセッションにアクセス可能
- **異なるユーザーID**: プロジェクトごとに異なるセッションとして管理

## 利用可能なツール

### 1. start_debate

議論セッションを開始します。

**パラメータ**:
- `initial_prompt` (string): 初期のトピックやリクエスト

**使用例**:
```
CodexとClaudeCodeに議論させて。まずはこのテーマで始めて：
「PythonでFizzBuzzを実装してください。」
```

### 2. step

前ターンの裁定結果を受けて、次のターンに進みます。

**パラメータ**:
- `decision` (object):
  - `type` (string): `"adopt_codex"`, `"adopt_claude"`, または `"custom_instruction"`
  - `custom_text` (string, optional): `type`が`"custom_instruction"`の場合に必要

**使用例**:
```
Codexの方針を採用して次に進めて
```

### 3. stop

現在の議論セッションを終了します。

**パラメータ**: なし

**使用例**:
```
ここで議論を終了して
```

## 使用例

### 完全な使用例

1. **議論を開始**:
   ```
   CodexとClaudeCodeに議論させて。まずはこのテーマで始めて：
   「PythonでFizzBuzzを実装してください。」
   ```

2. **次のステップに進む**（意見が割れた場合）:
   ```
   Claudeの方針を採用して次に進めて
   ```

3. **議論を終了**:
   ```
   ここで議論を終了して
   ```

### 実際のテスト例

以下のようなテストが成功しています：

- **FizzBuzzの実装**: CodexとClaudeが異なるアプローチを提案
- **テスト実装**: 両者がテストケースを追加
- **効率化の提案**: カスタム指示でより効率的な実装を要求

## トラブルシューティング

### MCPツールが表示されない場合

1. **Cursorを再起動**
2. **MCP設定を確認**
   - Settings → MCP で設定が正しく保存されているか確認
   - URLが `http://localhost:8080` になっているか確認
3. **MCPサーバーのログを確認**:
   ```bash
   docker logs multi-agent-cli-gateway-mcp
   ```

### ツールを呼び出してもエラーが出る場合

1. **MCPサーバーが起動しているか確認**:
   ```bash
   docker ps --filter "name=multi-agent-cli-gateway-mcp"
   ```

2. **ホストラッパーが起動しているか確認**:
   ```bash
   curl http://localhost:9001/health
   curl http://localhost:9002/health
   ```

3. **ログを確認**:
   ```bash
   docker logs multi-agent-cli-gateway-mcp
   tail -f .pids/codex_wrapper.log
   tail -f .pids/claude_wrapper.log
   ```

### セッションが共有される

- これは正常な動作です。同じユーザーIDを使用している場合、セッションが共有されます
- プロジェクトごとに異なるセッションが必要な場合は、異なるユーザーIDを使用してください

## 期待される動作

1. **start_debate**を呼び出すと：
   - CodexとClaudeの両方から応答が返される
   - セッションが開始される

2. **step**を呼び出すと：
   - 前ターンの裁定結果に基づいて、新しい応答が生成される
   - CodexとClaudeの両方から新しい応答が返される

3. **stop**を呼び出すと：
   - セッションが終了する
   - 状態がクリアされる

## 関連ドキュメント

- **セットアップ**: `SETUP.md`
- **セキュリティ**: `SECURITY.md`
- **リモートアクセス**: `REMOTE_ACCESS.md`

